# 数据利用测试规范

> 功能数: 55 | 模块数: 4
> 领域: 五、数据利用

本文档定义数据利用领域所有功能的测试规范，包含 BI 仪表板、数据服务发布、Text-to-SQL、RAG 检索四个模块。

---

## 目录

- [5.1 BI 仪表板 (BI)](#51-bi-仪表板-bi)
- [5.2 数据服务发布 (SVC)](#52-数据服务发布-svc)
- [5.3 Text-to-SQL (T2S)](#53-text-to-sql-t2s)
- [5.4 RAG 检索 (RAG)](#54-rag-检索-rag)

---

## 5.1 BI 仪表板 (BI)

**后端代码**: `services/data-api/models/bi.py`
**前端代码**: `web/src/pages/data/bi/BIPage.tsx`

### BI-001 仪表板创建

**实现目标**: 创建 BI 仪表板

**测试步骤**:
1. 进入 BI 仪表板页面
2. 点击"创建仪表板"
3. 填写仪表板名称和描述
4. 选择仪表板分类
5. 配置布局模板
6. 保存仪表板

**成功条件**:
- 仪表板创建成功
- 信息保存完整
- 分类选择正确
- 布局模板应用正确

**失败条件**:
- 仪表板创建失败
- 信息保存不完整
- 分类选择错误
- 布局模板应用错误

---

### BI-002 仪表板列表

**实现目标**: 查看仪表板列表

**测试步骤**:
1. 进入 BI 仪表板页面
2. 验证列表显示所有仪表板
3. 验证显示名称、创建人、更新时间
4. 测试按分类筛选
5. 测试搜索功能
6. 测试排序功能

**成功条件**:
- 列表完整显示
- 信息正确
- 筛选功能正常
- 搜索和排序正常

**失败条件**:
- 列表不完整
- 信息错误
- 筛选不工作
- 搜索或排序不工作

---

### BI-003 仪表板编辑

**实现目标**: 修改仪表板配置

**测试步骤**:
1. 选择仪表板点击编辑
2. 验证原配置加载
3. 修改仪表板名称
4. 修改布局
5. 添加/删除图表
6. 保存修改

**成功条件**:
- 配置正确加载
- 修改保存成功
- 布局修改生效
- 图表变更生效

**失败条件**:
- 配置加载失败
- 保存失败
- 布局修改不生效
- 图表变更不生效

---

### BI-004 仪表板删除

**实现目标**: 删除仪表板

**测试步骤**:
1. 选择仪表板
2. 点击删除
3. 确认删除
4. 验证仪表板移除
5. 验证关联图表处理
6. 尝试删除共享的仪表板

**成功条件**:
- 仪表板删除成功
- 列表更新
- 关联图表处理正确
- 共享仪表板提示

**失败条件**:
- 删除失败
- 列表不更新
- 关联图表处理错误
- 共享仪表板被强制删除

---

### BI-005 图表创建

**实现目标**: 在仪表板中创建图表

**测试步骤**:
1. 进入仪表板编辑模式
2. 点击"添加图表"
3. 选择图表类型
4. 配置数据源
5. 配置维度和指标
6. 保存图表

**成功条件**:
- 图表创建成功
- 图表类型正确
- 数据显示正确
- 图表在仪表板中显示

**失败条件**:
- 图表创建失败
- 图表类型错误
- 数据显示错误
- 图表不显示

---

### BI-006 图表编辑

**实现目标**: 修改图表配置

**测试步骤**:
1. 选择图表进入编辑
2. 验证原配置加载
3. 修改图表类型
4. 修改数据配置
5. 修改样式设置
6. 保存修改

**成功条件**:
- 配置正确加载
- 修改保存成功
- 类型切换正常
- 样式修改生效

**失败条件**:
- 配置加载失败
- 保存失败
- 类型切换异常
- 样式修改不生效

---

### BI-007 图表删除

**实现目标**: 删除仪表板中的图表

**测试步骤**:
1. 进入仪表板编辑模式
2. 选择要删除的图表
3. 点击删除按钮
4. 确认删除
5. 验证图表移除
6. 验证布局自动调整

**成功条件**:
- 图表删除成功
- 仪表板更新
- 布局自动调整
- 其他图表不受影响

**失败条件**:
- 图表删除失败
- 仪表板不更新
- 布局混乱
- 其他图表受影响

---

### BI-008 折线图

**实现目标**: 创建折线图

**测试步骤**:
1. 创建图表选择折线图类型
2. 配置 X 轴（时间维度）
3. 配置 Y 轴（数值指标）
4. 配置多条折线（可选）
5. 配置图例
6. 验证图表渲染

**成功条件**:
- 折线图正确渲染
- 数据点准确
- 多折线显示正确
- 图例显示正确

**失败条件**:
- 折线图不渲染
- 数据点不准确
- 多折线显示错误
- 图例不显示

---

### BI-009 柱状图

**实现目标**: 创建柱状图

**测试步骤**:
1. 创建图表选择柱状图类型
2. 配置 X 轴（分类维度）
3. 配置 Y 轴（数值指标）
4. 配置堆叠/分组模式
5. 配置颜色
6. 验证图表渲染

**成功条件**:
- 柱状图正确渲染
- 数据准确
- 堆叠/分组正确
- 颜色显示正确

**失败条件**:
- 柱状图不渲染
- 数据不准确
- 堆叠/分组错误
- 颜色显示错误

---

### BI-010 饼图

**实现目标**: 创建饼图

**测试步骤**:
1. 创建图表选择饼图类型
2. 配置分类维度
3. 配置数值指标
4. 配置显示百分比
5. 配置图例位置
6. 验证图表渲染

**成功条件**:
- 饼图正确渲染
- 比例计算正确
- 百分比显示正确
- 图例显示正确

**失败条件**:
- 饼图不渲染
- 比例计算错误
- 百分比显示错误
- 图例不显示

---

### BI-011 表格图

**实现目标**: 创建数据表格

**测试步骤**:
1. 创建图表选择表格类型
2. 配置显示列
3. 配置排序列
4. 配置分页
5. 配置条件格式
6. 验证表格渲染

**成功条件**:
- 表格正确渲染
- 列配置正确
- 排序功能正常
- 分页功能正常

**失败条件**:
- 表格不渲染
- 列配置错误
- 排序不正常
- 分页不正常

---

### BI-012 面积图

**实现目标**: 创建面积图

**测试步骤**:
1. 创建图表选择面积图类型
2. 配置 X 轴（时间维度）
3. 配置 Y 轴（数值指标）
4. 配置堆叠模式
5. 配置透明度
6. 验证图表渲染

**成功条件**:
- 面积图正确渲染
- 堆叠效果正确
- 透明度生效
- 数据准确

**失败条件**:
- 面积图不渲染
- 堆叠效果错误
- 透明度不生效
- 数据不准确

---

### BI-013 散点图

**实现目标**: 创建散点图

**测试步骤**:
1. 创建图表选择散点图类型
2. 配置 X 轴指标
3. 配置 Y 轴指标
4. 配置点大小（可选）
5. 配置点颜色（可选）
6. 验证图表渲染

**成功条件**:
- 散点图正确渲染
- 数据点位置正确
- 大小和颜色正确
- 支持交互

**失败条件**:
- 散点图不渲染
- 数据点位置错误
- 大小或颜色错误
- 不支持交互

---

### BI-014 布局配置

**实现目标**: 配置仪表板图表布局

**测试步骤**:
1. 进入仪表板编辑模式
2. 拖拽图表调整位置
3. 调整图表大小
4. 设置栅格对齐
5. 保存布局
6. 验证布局响应式

**成功条件**:
- 拖拽调整正常
- 大小调整正常
- 栅格对齐生效
- 响应式显示正确

**失败条件**:
- 拖拽调整异常
- 大小调整异常
- 栅格对齐不生效
- 响应式显示错误

---

### BI-015 全局筛选器

**实现目标**: 配置仪表板全局筛选器

**测试步骤**:
1. 进入仪表板编辑模式
2. 添加全局筛选器
3. 配置筛选字段
4. 关联需要筛选的图表
5. 保存配置
6. 测试筛选效果

**成功条件**:
- 筛选器添加成功
- 筛选字段正确
- 关联图表正确
- 筛选效果生效

**失败条件**:
- 筛选器添加失败
- 筛选字段错误
- 关联图表错误
- 筛选效果不生效

---

### BI-016 自动刷新

**实现目标**: 配置仪表板自动刷新

**测试步骤**:
1. 进入仪表板设置
2. 启用自动刷新
3. 配置刷新间隔（如 5 分钟）
4. 保存配置
5. 等待自动刷新
6. 验证数据更新

**成功条件**:
- 自动刷新配置成功
- 按间隔刷新
- 数据正确更新
- 刷新不影响交互

**失败条件**:
- 自动刷新配置失败
- 不按间隔刷新
- 数据不更新
- 刷新影响交互

---

### BI-017 仪表板分享

**实现目标**: 生成仪表板分享链接

**测试步骤**:
1. 选择仪表板
2. 点击"分享"按钮
3. 配置分享权限
4. 生成分享链接
5. 复制链接
6. 使用链接访问验证

**成功条件**:
- 分享链接生成成功
- 权限配置生效
- 链接可访问
- 数据正确显示

**失败条件**:
- 分享链接生成失败
- 权限配置不生效
- 链接不可访问
- 数据显示错误

---

### BI-018 仪表板收藏

**实现目标**: 收藏常用仪表板

**测试步骤**:
1. 选择仪表板点击收藏
2. 验证收藏成功
3. 查看我的收藏列表
4. 验证收藏仪表板显示
5. 取消收藏
6. 验证取消成功

**成功条件**:
- 收藏操作成功
- 收藏列表显示
- 取消收藏成功
- 状态同步正确

**失败条件**:
- 收藏操作失败
- 收藏列表不显示
- 取消收藏失败
- 状态不同步

---

### BI-019 图表缓存

**实现目标**: 配置图表数据缓存

**测试步骤**:
1. 进入图表设置
2. 启用数据缓存
3. 配置缓存时间
4. 保存配置
5. 刷新图表验证缓存
6. 测试缓存过期

**成功条件**:
- 缓存配置成功
- 缓存生效
- 缓存提升加载速度
- 缓存过期后更新

**失败条件**:
- 缓存配置失败
- 缓存不生效
- 缓存不提升速度
- 缓存不过期

---

### BI-020 Superset 集成

**实现目标**: 集成 Apache Superset

**测试步骤**:
1. 配置 Superset 连接
2. 导入 Superset 仪表板
3. 查看导入的仪表板
4. 同步 Superset 数据源
5. 在平台中查看 Superset 图表
6. 测试双向同步

**成功条件**:
- Superset 连接成功
- 仪表板导入成功
- 图表正确显示
- 同步功能正常

**失败条件**:
- Superset 连接失败
- 仪表板导入失败
- 图表显示错误
- 同步功能异常

---

### BI-021 AI 图表推荐

**实现目标**: AI 推荐合适的图表类型

**测试步骤**:
1. 选择数据集
2. 点击"AI 推荐"
3. 等待 AI 分析完成
4. 查看推荐的图表类型
5. 评估推荐合理性
6. 采纳或修改推荐

**成功条件**:
- AI 推荐功能可用
- 推荐结果合理
- 可采纳推荐
- 可修改推荐

**失败条件**:
- AI 推荐不可用
- 推荐结果不合理
- 无法采纳
- 无法修改

---

## 5.2 数据服务发布 (SVC)

**后端代码**: `services/data-api/models/data_service.py`
**前端代码**: `web/src/pages/data/services/ServicesPage.tsx`

### SVC-001 数据服务创建

**实现目标**: 创建数据服务 API

**测试步骤**:
1. 进入数据服务页面
2. 点击"创建服务"
3. 填写服务名称和描述
4. 选择服务类型
5. 配置数据源
6. 保存服务

**成功条件**:
- 服务创建成功
- 信息保存完整
- 服务类型正确
- 数据源配置正确

**失败条件**:
- 服务创建失败
- 信息保存不完整
- 服务类型错误
- 数据源配置错误

---

### SVC-002 数据服务列表

**实现目标**: 查看数据服务列表

**测试步骤**:
1. 进入数据服务页面
2. 验证列表显示所有服务
3. 验证显示名称、类型、状态
4. 测试按类型筛选
5. 测试按状态筛选
6. 测试搜索功能

**成功条件**:
- 列表完整显示
- 信息正确
- 筛选功能正常
- 搜索功能正常

**失败条件**:
- 列表不完整
- 信息错误
- 筛选不工作
- 搜索不工作

---

### SVC-003 数据服务编辑

**实现目标**: 修改数据服务配置

**测试步骤**:
1. 选择服务点击编辑
2. 验证原配置加载
3. 修改数据源配置
4. 修改参数配置
5. 保存修改

**成功条件**:
- 配置正确加载
- 修改保存成功
- 修改生效
- 版本更新

**失败条件**:
- 配置加载失败
- 保存失败
- 修改不生效
- 版本不更新

---

### SVC-004 数据服务删除

**实现目标**: 删除数据服务

**测试步骤**:
1. 选择已停止的服务
2. 点击删除
3. 确认删除
4. 验证服务移除
5. 尝试删除运行中的服务

**成功条件**:
- 服务删除成功
- 列表更新
- 运行中服务提示
- 记录日志

**失败条件**:
- 删除失败
- 列表不更新
- 运行中服务被删除
- 无确认

---

### SVC-005 服务启动

**实现目标**: 启动数据服务

**测试步骤**:
1. 选择已停止的服务
2. 点击"启动"
3. 验证服务状态变为 running
4. 验证 API 端点可访问
5. 发送测试请求
6. 验证返回正确数据

**成功条件**:
- 服务启动成功
- 状态更新正确
- API 可访问
- 数据返回正确

**失败条件**:
- 服务启动失败
- 状态不更新
- API 不可访问
- 数据返回错误

---

### SVC-006 服务停止

**实现目标**: 停止数据服务

**测试步骤**:
1. 选择运行中的服务
2. 点击"停止"
3. 验证服务状态变为 stopped
4. 验证 API 端点不可访问
5. 发送请求验证返回错误

**成功条件**:
- 服务停止成功
- 状态更新正确
- API 不可访问
- 返回适当错误

**失败条件**:
- 服务停止失败
- 状态不更新
- API 仍可访问
- 无错误返回

---

### SVC-007 REST API 服务

**实现目标**: 创建 REST API 服务

**测试步骤**:
1. 创建服务选择 REST API 类型
2. 配置 HTTP 方法（GET/POST）
3. 配置路径参数
4. 配置查询参数
5. 配置响应格式
6. 测试 API 调用

**成功条件**:
- REST API 创建成功
- HTTP 方法正确
- 参数处理正确
- 响应格式正确

**失败条件**:
- REST API 创建失败
- HTTP 方法错误
- 参数处理错误
- 响应格式错误

---

### SVC-008 WebSocket 服务

**实现目标**: 创建 WebSocket 服务

**测试步骤**:
1. 创建服务选择 WebSocket 类型
2. 配置连接端点
3. 配置消息格式
4. 配置心跳设置
5. 测试 WebSocket 连接
6. 测试实时数据推送

**成功条件**:
- WebSocket 服务创建成功
- 连接建立成功
- 消息格式正确
- 实时推送正常

**失败条件**:
- WebSocket 服务创建失败
- 连接建立失败
- 消息格式错误
- 实时推送异常

---

### SVC-009 文件下载服务

**实现目标**: 创建文件下载服务

**测试步骤**:
1. 创建服务选择文件下载类型
2. 配置数据源查询
3. 配置文件格式（CSV/Excel）
4. 配置文件名规则
5. 测试文件下载
6. 验证文件内容正确

**成功条件**:
- 文件下载服务创建成功
- 文件格式正确
- 文件名正确
- 内容准确

**失败条件**:
- 文件下载服务创建失败
- 文件格式错误
- 文件名错误
- 内容不准确

---

### SVC-010 SQL 数据源配置

**实现目标**: 配置 SQL 查询作为数据源

**测试步骤**:
1. 编辑服务数据源
2. 选择 SQL 查询方式
3. 编写 SQL 语句
4. 配置参数化变量
5. 测试 SQL 执行
6. 验证返回结果

**成功条件**:
- SQL 配置成功
- 参数化生效
- SQL 执行成功
- 结果正确

**失败条件**:
- SQL 配置失败
- 参数化不生效
- SQL 执行失败
- 结果错误

---

### SVC-011 请求参数配置

**实现目标**: 配置 API 请求参数

**测试步骤**:
1. 编辑服务参数配置
2. 添加路径参数
3. 添加查询参数
4. 添加请求体参数
5. 配置参数校验规则
6. 测试参数处理

**成功条件**:
- 参数配置成功
- 各类型参数正确
- 校验规则生效
- 参数传递正确

**失败条件**:
- 参数配置失败
- 参数类型错误
- 校验规则不生效
- 参数传递错误

---

### SVC-012 响应格式配置

**实现目标**: 配置响应格式（JSON/XML/CSV）

**测试步骤**:
1. 编辑服务响应配置
2. 选择 JSON 格式
3. 测试 JSON 响应
4. 切换到 XML 格式
5. 测试 XML 响应
6. 切换到 CSV 格式

**成功条件**:
- 格式配置成功
- JSON 响应正确
- XML 响应正确
- CSV 响应正确

**失败条件**:
- 格式配置失败
- JSON 响应错误
- XML 响应错误
- CSV 响应错误

---

### SVC-013 无认证

**实现目标**: 配置无认证访问

**测试步骤**:
1. 编辑服务认证配置
2. 选择无认证模式
3. 保存配置
4. 无任何认证信息调用 API
5. 验证可正常访问

**成功条件**:
- 无认证配置成功
- 无认证可访问
- 响应正确
- 适用于公开数据

**失败条件**:
- 无认证配置失败
- 无认证不可访问
- 响应错误
- 安全风险提示

---

### SVC-014 API Key 认证

**实现目标**: 配置 API Key 认证

**测试步骤**:
1. 编辑服务认证配置
2. 选择 API Key 认证
3. 生成 API Key
4. 配置 Key 传递方式（Header/Query）
5. 使用 API Key 调用
6. 验证无 Key 时拒绝访问

**成功条件**:
- API Key 配置成功
- Key 生成成功
- 有 Key 可访问
- 无 Key 被拒绝

**失败条件**:
- API Key 配置失败
- Key 生成失败
- 有 Key 不可访问
- 无 Key 仍可访问

---

### SVC-015 OAuth 认证

**实现目标**: 配置 OAuth 认证

**测试步骤**:
1. 编辑服务认证配置
2. 选择 OAuth 认证
3. 配置 OAuth 提供方
4. 配置 Client ID/Secret
5. 测试 OAuth 授权流程
6. 使用 Token 访问 API

**成功条件**:
- OAuth 配置成功
- 授权流程正常
- Token 获取成功
- API 访问正常

**失败条件**:
- OAuth 配置失败
- 授权流程异常
- Token 获取失败
- API 访问失败

---

### SVC-016 JWT 认证

**实现目标**: 配置 JWT 认证

**测试步骤**:
1. 编辑服务认证配置
2. 选择 JWT 认证
3. 配置 JWT 密钥
4. 配置 Token 过期时间
5. 生成 JWT Token
6. 使用 Token 访问 API

**成功条件**:
- JWT 配置成功
- Token 生成成功
- 有效 Token 可访问
- 过期 Token 被拒绝

**失败条件**:
- JWT 配置失败
- Token 生成失败
- 有效 Token 不可访问
- 过期 Token 仍可访问

---

### SVC-017 限流配置

**实现目标**: 配置请求限流

**测试步骤**:
1. 编辑服务限流配置
2. 配置每分钟请求限制
3. 配置每天请求限制
4. 配置限流响应
5. 测试超过限制
6. 验证限流生效

**成功条件**:
- 限流配置成功
- 分钟限制生效
- 每天限制生效
- 超限正确响应

**失败条件**:
- 限流配置失败
- 分钟限制不生效
- 每天限制不生效
- 超限无响应

---

### SVC-018 缓存配置

**实现目标**: 配置响应数据缓存

**测试步骤**:
1. 编辑服务缓存配置
2. 启用响应缓存
3. 配置缓存时间
4. 配置缓存 Key 规则
5. 测试缓存命中
6. 测试缓存失效

**成功条件**:
- 缓存配置成功
- 缓存命中生效
- 响应速度提升
- 缓存正确失效

**失败条件**:
- 缓存配置失败
- 缓存命中不生效
- 响应速度不提升
- 缓存不失效

---

### SVC-019 调用统计

**实现目标**: 统计服务调用情况

**测试步骤**:
1. 查看服务统计面板
2. 验证显示调用次数
3. 验证显示成功率
4. 验证显示错误分布
5. 查看调用趋势图
6. 导出统计报表

**成功条件**:
- 统计数据准确
- 成功率正确
- 错误分布正确
- 趋势图正确

**失败条件**:
- 统计数据不准确
- 成功率错误
- 错误分布错误
- 趋势图错误

---

### SVC-020 调用日志查看

**实现目标**: 查看服务调用日志

**测试步骤**:
1. 进入服务日志页面
2. 查看调用日志列表
3. 按时间筛选
4. 按状态筛选
5. 查看详细请求/响应
6. 导出日志

**成功条件**:
- 日志列表完整
- 筛选功能正常
- 详情可查看
- 导出功能正常

**失败条件**:
- 日志列表不完整
- 筛选不工作
- 详情不可查看
- 导出失败

---

### SVC-021 响应时间监控

**实现目标**: 监控平均响应时间

**测试步骤**:
1. 查看服务监控面板
2. 验证显示平均响应时间
3. 验证显示 P95/P99 响应时间
4. 查看响应时间趋势
5. 配置响应时间告警
6. 测试慢请求告警

**成功条件**:
- 响应时间显示正确
- 百分位计算正确
- 趋势图正确
- 告警生效

**失败条件**:
- 响应时间显示错误
- 百分位计算错误
- 趋势图错误
- 告警不生效

---

### SVC-022 版本管理

**实现目标**: 管理服务版本

**测试步骤**:
1. 查看服务版本列表
2. 创建新版本
3. 配置版本路由
4. 测试不同版本访问
5. 设置默认版本
6. 废弃旧版本

**成功条件**:
- 版本列表显示
- 新版本创建成功
- 版本路由正确
- 版本切换正常

**失败条件**:
- 版本列表不显示
- 新版本创建失败
- 版本路由错误
- 版本切换异常

---

## 5.3 Text-to-SQL (T2S)

**后端代码**: `services/data-api/src/sql_executor.py`

### T2S-001 自然语言查询

**实现目标**: 用自然语言描述查询需求

**测试步骤**:
1. 进入 Text-to-SQL 页面
2. 选择目标数据库
3. 输入自然语言查询
4. 验证查询被正确理解
5. 测试中文查询
6. 测试英文查询

**成功条件**:
- 自然语言输入正常
- 查询意图被理解
- 中文查询支持
- 英文查询支持

**失败条件**:
- 自然语言输入异常
- 查询意图误解
- 中文查询不支持
- 英文查询不支持

---

### T2S-002 SQL 生成

**实现目标**: AI 根据自然语言生成 SQL

**测试步骤**:
1. 输入自然语言查询
2. 等待 AI 生成 SQL
3. 查看生成的 SQL
4. 验证 SQL 语法正确
5. 验证 SQL 语义正确
6. 测试复杂查询生成

**成功条件**:
- SQL 生成成功
- SQL 语法正确
- SQL 语义正确
- 复杂查询支持

**失败条件**:
- SQL 生成失败
- SQL 语法错误
- SQL 语义错误
- 复杂查询不支持

---

### T2S-003 元数据注入

**实现目标**: 自动注入表结构到 Prompt

**测试步骤**:
1. 选择目标数据库
2. 验证自动加载表结构
3. 验证字段信息注入
4. 验证表关系注入
5. 验证字段描述注入
6. 测试大量表的处理

**成功条件**:
- 表结构自动加载
- 字段信息正确
- 表关系正确
- 描述信息正确

**失败条件**:
- 表结构不加载
- 字段信息错误
- 表关系错误
- 描述信息缺失

---

### T2S-004 SQL 执行

**实现目标**: 执行生成的 SQL

**测试步骤**:
1. 生成 SQL 后点击执行
2. 验证 SQL 正确执行
3. 验证执行安全检查
4. 测试只读限制
5. 测试执行超时
6. 查看执行日志

**成功条件**:
- SQL 执行成功
- 安全检查生效
- 只读限制生效
- 超时处理正确

**失败条件**:
- SQL 执行失败
- 安全检查不生效
- 只读限制不生效
- 超时处理错误

---

### T2S-005 结果展示

**实现目标**: 展示查询结果

**测试步骤**:
1. 执行查询
2. 查看结果表格
3. 验证列名显示
4. 验证数据显示
5. 测试大数据量分页
6. 导出查询结果

**成功条件**:
- 结果表格显示
- 列名正确
- 数据正确
- 导出功能正常

**失败条件**:
- 结果表格不显示
- 列名错误
- 数据错误
- 导出功能失败

---

### T2S-006 自然语言解释

**实现目标**: AI 用自然语言解释查询结果

**测试步骤**:
1. 执行查询得到结果
2. 点击"AI 解释"
3. 等待 AI 分析结果
4. 查看自然语言解释
5. 评估解释质量
6. 测试多种结果类型解释

**成功条件**:
- AI 解释功能可用
- 解释内容准确
- 解释易于理解
- 多种类型支持

**失败条件**:
- AI 解释不可用
- 解释内容不准确
- 解释难以理解
- 部分类型不支持

---

## 5.4 RAG 检索 (RAG)

**后端代码**: `services/data-api/src/semantic_search.py`

### RAG-001 向量检索

**实现目标**: 基于向量的语义检索

**测试步骤**:
1. 进入 RAG 检索页面
2. 选择知识库
3. 输入查询文本
4. 执行向量检索
5. 查看检索结果
6. 验证语义相关性

**成功条件**:
- 向量检索执行成功
- 检索结果返回
- 语义相关性高
- 响应速度快

**失败条件**:
- 向量检索执行失败
- 检索结果不返回
- 语义相关性低
- 响应速度慢

---

### RAG-002 文档切片

**实现目标**: 文档自动切片

**测试步骤**:
1. 上传文档
2. 查看自动切片结果
3. 验证切片大小合理
4. 验证切片边界合理
5. 测试不同文档格式
6. 测试长文档切片

**成功条件**:
- 切片自动完成
- 切片大小合理
- 边界不断句
- 各格式支持

**失败条件**:
- 切片失败
- 切片大小不合理
- 边界断句
- 部分格式不支持

---

### RAG-003 Embedding 生成

**实现目标**: 生成文档 Embedding

**测试步骤**:
1. 上传或选择文档
2. 触发 Embedding 生成
3. 查看生成进度
4. 验证 Embedding 存储
5. 测试不同模型
6. 验证 Embedding 质量

**成功条件**:
- Embedding 生成成功
- 进度显示正确
- 存储成功
- 质量合格

**失败条件**:
- Embedding 生成失败
- 进度不显示
- 存储失败
- 质量不合格

---

### RAG-004 相似度搜索

**实现目标**: 搜索相似文档片段

**测试步骤**:
1. 输入查询文本
2. 执行相似度搜索
3. 查看相似片段列表
4. 验证相似度分数
5. 调整 Top-K 参数
6. 调整相似度阈值

**成功条件**:
- 相似度搜索成功
- 片段列表正确
- 相似度分数准确
- 参数调整生效

**失败条件**:
- 相似度搜索失败
- 片段列表错误
- 相似度分数不准确
- 参数调整不生效

---

### RAG-005 结果排序

**实现目标**: 按相关度排序结果

**测试步骤**:
1. 执行检索获取结果
2. 验证默认按相关度排序
3. 测试切换排序方式
4. 验证排序结果正确
5. 测试多字段排序
6. 测试自定义排序

**成功条件**:
- 默认排序正确
- 排序切换正常
- 排序结果准确
- 自定义排序支持

**失败条件**:
- 默认排序错误
- 排序切换异常
- 排序结果不准确
- 自定义排序不支持

---

### RAG-006 RAG 回答生成

**实现目标**: 基于检索结果生成回答

**测试步骤**:
1. 输入问题
2. 执行 RAG 检索
3. 等待 AI 生成回答
4. 查看生成的回答
5. 验证回答引用来源
6. 评估回答质量

**成功条件**:
- 回答生成成功
- 回答内容准确
- 引用来源正确
- 回答质量高

**失败条件**:
- 回答生成失败
- 回答内容不准确
- 引用来源错误
- 回答质量低

---

## 统计汇总

| 模块 | 功能数 | 功能编号范围 |
|------|--------|-------------|
| BI 仪表板 (BI) | 21 | BI-001 ~ BI-021 |
| 数据服务发布 (SVC) | 22 | SVC-001 ~ SVC-022 |
| Text-to-SQL (T2S) | 6 | T2S-001 ~ T2S-006 |
| RAG 检索 (RAG) | 6 | RAG-001 ~ RAG-006 |
| **总计** | **55** | |

---

## 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| 1.0.0 | 2026-02-09 | 初始版本 |
