# 平台支撑测试规范

> 功能数: 35 | 模块数: 4
> 领域: 六、平台支撑

本文档定义平台支撑领域所有功能的测试规范，包含审批工作流、AI 增强功能、认证与授权、集成能力四个模块。

---

## 目录

- [6.1 审批工作流 (APR)](#61-审批工作流-apr)
- [6.2 AI 增强功能 (AI)](#62-ai-增强功能-ai)
- [6.3 认证与授权 (AUTH)](#63-认证与授权-auth)
- [6.4 集成能力 (INT)](#64-集成能力-int)

---

## 6.1 审批工作流 (APR)

**后端代码**: `services/data-api/models/approval.py`

**支持的业务类型**:
- data_access (数据访问)
- data_masking (数据脱敏)
- etl_publish (ETL发布)
- asset_change (资产变更)
- security_exception (安全例外)

### APR-001 审批模板创建

**实现目标**: 创建审批流程模板

**测试步骤**:
1. 进入审批管理页面
2. 点击"创建审批模板"
3. 填写模板名称和描述
4. 选择业务类型
5. 配置审批节点
6. 保存模板

**成功条件**:
- 模板创建成功
- 信息保存完整
- 业务类型正确
- 节点配置正确

**失败条件**:
- 模板创建失败
- 信息保存不完整
- 业务类型错误
- 节点配置错误

---

### APR-002 审批模板列表

**实现目标**: 查看审批模板列表

**测试步骤**:
1. 进入审批管理页面
2. 验证列表显示所有模板
3. 验证显示名称、类型、状态
4. 测试按业务类型筛选
5. 测试搜索功能

**成功条件**:
- 列表完整显示
- 信息正确
- 筛选功能正常
- 搜索功能正常

**失败条件**:
- 列表不完整
- 信息错误
- 筛选不工作
- 搜索不工作

---

### APR-003 审批模板编辑

**实现目标**: 修改审批模板

**测试步骤**:
1. 选择模板点击编辑
2. 验证原配置加载
3. 修改审批节点
4. 修改审批条件
5. 保存修改

**成功条件**:
- 配置正确加载
- 修改保存成功
- 节点修改生效
- 条件修改生效

**失败条件**:
- 配置加载失败
- 保存失败
- 节点修改不生效
- 条件修改不生效

---

### APR-004 多级审批节点

**实现目标**: 配置多级审批节点

**测试步骤**:
1. 编辑审批模板
2. 添加第一级审批节点
3. 添加第二级审批节点
4. 添加第三级审批节点
5. 配置节点顺序
6. 测试多级审批流程

**成功条件**:
- 多级节点配置成功
- 顺序配置正确
- 审批按顺序流转
- 每级审批生效

**失败条件**:
- 多级节点配置失败
- 顺序配置错误
- 审批不按顺序
- 某级审批不生效

---

### APR-005 角色审批人

**实现目标**: 按角色指定审批人

**测试步骤**:
1. 编辑审批节点
2. 选择"按角色"指定审批人
3. 选择审批角色（如数据管理员）
4. 保存配置
5. 提交工单验证角色成员收到
6. 测试多人角色审批

**成功条件**:
- 角色配置成功
- 角色成员收到审批
- 任一角色成员可审批
- 审批记录正确

**失败条件**:
- 角色配置失败
- 角色成员未收到
- 非角色成员可审批
- 审批记录错误

---

### APR-006 审批工单提交

**实现目标**: 提交审批工单

**测试步骤**:
1. 进入需要审批的功能
2. 触发审批提交
3. 填写申请表单
4. 填写申请理由
5. 提交工单
6. 验证工单创建成功

**成功条件**:
- 工单提交成功
- 表单保存完整
- 理由保存完整
- 工单状态正确

**失败条件**:
- 工单提交失败
- 表单保存不完整
- 理由丢失
- 工单状态错误

---

### APR-007 审批工单列表

**实现目标**: 查看审批工单列表

**测试步骤**:
1. 进入工单管理页面
2. 查看我提交的工单
3. 查看待我审批的工单
4. 查看所有工单（管理员）
5. 测试按状态筛选
6. 测试按时间筛选

**成功条件**:
- 工单列表完整
- 筛选功能正常
- 权限控制正确
- 实时更新

**失败条件**:
- 工单列表不完整
- 筛选不工作
- 权限控制错误
- 不实时更新

---

### APR-008 审批工单详情

**实现目标**: 查看工单详情

**测试步骤**:
1. 在工单列表选择一个工单
2. 点击查看详情
3. 验证显示申请内容
4. 验证显示申请人信息
5. 验证显示审批进度
6. 验证显示审批历史

**成功条件**:
- 详情页面完整
- 申请内容正确
- 审批进度正确
- 审批历史正确

**失败条件**:
- 详情页面不完整
- 申请内容错误
- 审批进度错误
- 审批历史错误

---

### APR-009 工单审批通过

**实现目标**: 审批通过工单

**测试步骤**:
1. 进入待审批工单
2. 查看工单详情
3. 填写审批意见
4. 点击"通过"
5. 验证工单状态更新
6. 验证触发下一级或完成

**成功条件**:
- 审批通过成功
- 状态更新正确
- 意见保存正确
- 流程正确流转

**失败条件**:
- 审批通过失败
- 状态不更新
- 意见丢失
- 流程流转错误

---

### APR-010 工单审批驳回

**实现目标**: 驳回审批工单

**测试步骤**:
1. 进入待审批工单
2. 查看工单详情
3. 填写驳回理由
4. 点击"驳回"
5. 验证工单状态变为驳回
6. 验证申请人收到通知

**成功条件**:
- 审批驳回成功
- 状态更新为驳回
- 驳回理由保存
- 申请人收到通知

**失败条件**:
- 审批驳回失败
- 状态不更新
- 驳回理由丢失
- 申请人未收到通知

---

### APR-011 工单撤回

**实现目标**: 撤回已提交的工单

**测试步骤**:
1. 进入我提交的工单列表
2. 选择待审批状态的工单
3. 点击"撤回"
4. 确认撤回
5. 验证工单状态变为撤回
6. 尝试撤回已审批的工单

**成功条件**:
- 撤回操作成功
- 状态更新为撤回
- 已审批工单不可撤回
- 记录撤回日志

**失败条件**:
- 撤回操作失败
- 状态不更新
- 已审批工单可撤回
- 无撤回日志

---

### APR-012 审批委派

**实现目标**: 将审批委派给他人

**测试步骤**:
1. 进入待审批工单
2. 点击"委派"
3. 选择委派目标人员
4. 填写委派原因
5. 确认委派
6. 验证委派人收到审批任务

**成功条件**:
- 委派操作成功
- 委派人收到任务
- 原审批人任务移除
- 委派记录保存

**失败条件**:
- 委派操作失败
- 委派人未收到任务
- 原审批人任务未移除
- 委派记录丢失

---

### APR-013 审批记录查看

**实现目标**: 查看审批历史记录

**测试步骤**:
1. 打开工单详情
2. 查看审批记录页签
3. 验证显示每次审批操作
4. 验证显示审批人
5. 验证显示审批时间
6. 验证显示审批意见

**成功条件**:
- 审批记录完整
- 审批人正确
- 审批时间准确
- 审批意见显示

**失败条件**:
- 审批记录不完整
- 审批人错误
- 审批时间不准确
- 审批意见不显示

---

### APR-014 自动过期

**实现目标**: 工单超时自动处理

**测试步骤**:
1. 配置工单过期时间
2. 提交工单
3. 等待超过过期时间
4. 验证工单自动处理
5. 验证通知发送
6. 测试不同过期策略

**成功条件**:
- 过期配置成功
- 超时自动处理
- 通知正确发送
- 策略正确执行

**失败条件**:
- 过期配置失败
- 超时不处理
- 通知未发送
- 策略执行错误

---

### APR-015 通知配置

**实现目标**: 配置审批通知

**测试步骤**:
1. 进入审批通知配置
2. 配置待审批通知
3. 配置审批结果通知
4. 配置提醒通知
5. 选择通知渠道
6. 测试通知发送

**成功条件**:
- 通知配置成功
- 各类型通知生效
- 渠道选择生效
- 通知及时送达

**失败条件**:
- 通知配置失败
- 通知不生效
- 渠道选择不生效
- 通知延迟或丢失

---

## 6.2 AI 增强功能 (AI)

**后端代码**: `services/data-api/services/ai_*.py`

### AI-001 AI 字段标注

**实现目标**: AI 自动生成字段描述

**测试步骤**:
1. 选择需要标注的表
2. 点击"AI 字段标注"
3. 等待 AI 分析完成
4. 查看生成的字段描述
5. 评估描述质量
6. 批量应用或修改

**成功条件**:
- AI 标注功能可用
- 描述生成合理
- 可批量应用
- 可手动修改

**失败条件**:
- AI 标注不可用
- 描述生成不合理
- 无法批量应用
- 无法手动修改

---

### AI-002 AI 字段映射

**实现目标**: AI 智能推荐字段映射

**测试步骤**:
1. 创建 ETL 任务
2. 配置源端和目标端
3. 点击"AI 智能映射"
4. 查看推荐的映射关系
5. 评估映射准确性
6. 采纳或调整映射

**成功条件**:
- AI 映射功能可用
- 映射推荐合理
- 可采纳推荐
- 可调整推荐

**失败条件**:
- AI 映射不可用
- 映射推荐不合理
- 无法采纳
- 无法调整

---

### AI-003 AI 清洗规则建议

**实现目标**: AI 推荐数据清洗规则

**测试步骤**:
1. 选择有质量问题的数据
2. 点击"AI 清洗建议"
3. 等待 AI 分析完成
4. 查看推荐的清洗规则
5. 评估规则有效性
6. 应用清洗规则

**成功条件**:
- AI 建议功能可用
- 清洗规则合理
- 规则可应用
- 清洗效果好

**失败条件**:
- AI 建议不可用
- 清洗规则不合理
- 规则无法应用
- 清洗效果差

---

### AI-004 AI 资产搜索

**实现目标**: AI 语义搜索数据资产

**测试步骤**:
1. 进入资产搜索页面
2. 输入自然语言描述
3. 执行 AI 搜索
4. 查看搜索结果
5. 评估结果相关性
6. 测试模糊搜索

**成功条件**:
- AI 搜索功能可用
- 结果相关性高
- 排序合理
- 模糊搜索有效

**失败条件**:
- AI 搜索不可用
- 结果相关性低
- 排序不合理
- 模糊搜索无效

---

### AI-005 AI 图表推荐

**实现目标**: AI 推荐合适的图表类型

**测试步骤**:
1. 选择数据集
2. 点击"AI 推荐图表"
3. 等待 AI 分析完成
4. 查看推荐的图表类型
5. 评估推荐合理性
6. 选择并创建图表

**成功条件**:
- AI 推荐功能可用
- 图表类型推荐合理
- 可选择推荐
- 图表创建成功

**失败条件**:
- AI 推荐不可用
- 图表类型推荐不合理
- 无法选择推荐
- 图表创建失败

---

### AI-006 AI 异常预测

**实现目标**: AI 预测数据异常

**测试步骤**:
1. 选择监控数据
2. 启用 AI 异常预测
3. 配置预测参数
4. 查看预测结果
5. 评估预测准确性
6. 根据预测采取措施

**成功条件**:
- AI 预测功能可用
- 预测结果合理
- 预测准确性高
- 可采取措施

**失败条件**:
- AI 预测不可用
- 预测结果不合理
- 预测准确性低
- 无法采取措施

---

### AI-007 AI 调度优化

**实现目标**: AI 优化任务调度

**测试步骤**:
1. 选择多个任务
2. 点击"AI 调度优化"
3. 等待 AI 分析完成
4. 查看优化建议
5. 评估建议合理性
6. 应用优化方案

**成功条件**:
- AI 优化功能可用
- 优化建议合理
- 可应用建议
- 调度效率提升

**失败条件**:
- AI 优化不可用
- 优化建议不合理
- 无法应用建议
- 调度效率不提升

---

### AI-008 AI 敏感识别

**实现目标**: AI 识别敏感数据

**测试步骤**:
1. 选择扫描范围
2. 启用 AI 敏感识别
3. 执行扫描
4. 查看识别结果
5. 评估识别准确性
6. 确认或修正结果

**成功条件**:
- AI 识别功能可用
- 识别结果准确
- 可确认结果
- 可修正错误

**失败条件**:
- AI 识别不可用
- 识别结果不准确
- 无法确认结果
- 无法修正错误

---

### AI-009 AI 数据填充建议

**实现目标**: AI 推荐数据填充策略

**测试步骤**:
1. 选择有缺失值的数据
2. 点击"AI 填充建议"
3. 等待 AI 分析完成
4. 查看推荐的填充策略
5. 评估策略合理性
6. 应用填充策略

**成功条件**:
- AI 建议功能可用
- 填充策略合理
- 可应用策略
- 填充效果好

**失败条件**:
- AI 建议不可用
- 填充策略不合理
- 无法应用策略
- 填充效果差

---

## 6.3 认证与授权 (AUTH)

**后端代码**: `services/data-api/models/oauth2_client.py`, `services/data-api/services/unified_auth_service.py`

### AUTH-001 OAuth2 客户端管理

**实现目标**: 管理 OAuth2 客户端

**测试步骤**:
1. 进入 OAuth2 管理页面
2. 创建 OAuth2 客户端
3. 配置 Client ID 和 Secret
4. 配置授权范围
5. 配置回调 URL
6. 测试 OAuth2 授权流程

**成功条件**:
- 客户端创建成功
- 配置保存正确
- 授权流程正常
- Token 获取成功

**失败条件**:
- 客户端创建失败
- 配置保存错误
- 授权流程异常
- Token 获取失败

---

### AUTH-002 API Key 管理

**实现目标**: 管理 API Key

**测试步骤**:
1. 进入 API Key 管理页面
2. 创建新的 API Key
3. 配置 Key 权限范围
4. 配置 Key 过期时间
5. 测试 Key 使用
6. 吊销 API Key

**成功条件**:
- API Key 创建成功
- 权限范围生效
- 过期时间生效
- 吊销功能正常

**失败条件**:
- API Key 创建失败
- 权限范围不生效
- 过期时间不生效
- 吊销功能异常

---

### AUTH-003 Token 管理

**实现目标**: Token 签发和吊销

**测试步骤**:
1. 请求 Token 签发
2. 验证 Token 格式正确
3. 使用 Token 访问 API
4. 刷新过期 Token
5. 吊销 Token
6. 验证吊销 Token 不可用

**成功条件**:
- Token 签发成功
- Token 格式正确
- Token 访问正常
- 吊销生效

**失败条件**:
- Token 签发失败
- Token 格式错误
- Token 访问失败
- 吊销不生效

---

### AUTH-004 SSO 集成

**实现目标**: 单点登录集成

**测试步骤**:
1. 配置 SSO 提供方
2. 配置 SSO 参数
3. 测试 SSO 登录
4. 验证用户信息同步
5. 测试 SSO 登出
6. 测试 Session 同步

**成功条件**:
- SSO 配置成功
- 登录流程正常
- 用户信息同步
- 登出生效

**失败条件**:
- SSO 配置失败
- 登录流程异常
- 用户信息不同步
- 登出不生效

---

### AUTH-005 认证审计

**实现目标**: 认证操作审计日志

**测试步骤**:
1. 执行登录操作
2. 执行登出操作
3. 执行 Token 操作
4. 查看认证审计日志
5. 验证操作记录完整
6. 验证敏感信息脱敏

**成功条件**:
- 认证操作被记录
- 日志信息完整
- 敏感信息脱敏
- 可追溯查询

**失败条件**:
- 认证操作未记录
- 日志信息不完整
- 敏感信息泄露
- 无法追溯查询

---

## 6.4 集成能力 (INT)

**后端代码**: `services/data-api/integrations/`

### INT-001 OpenMetadata 集成

**实现目标**: 集成 OpenMetadata 元数据管理

**测试步骤**:
1. 配置 OpenMetadata 连接
2. 同步元数据到 OpenMetadata
3. 从 OpenMetadata 导入元数据
4. 验证元数据双向同步
5. 测试血缘信息同步
6. 测试质量信息同步

**成功条件**:
- 连接配置成功
- 元数据同步正常
- 双向同步生效
- 各类信息同步

**失败条件**:
- 连接配置失败
- 元数据同步失败
- 双向同步不生效
- 部分信息不同步

---

### INT-002 Great Expectations 集成

**实现目标**: 集成 GE 数据质量引擎

**测试步骤**:
1. 配置 Great Expectations 连接
2. 导入 GE Expectation Suite
3. 执行 GE 质量检查
4. 查看 GE 检查结果
5. 同步结果到平台
6. 生成 GE 数据文档

**成功条件**:
- GE 连接成功
- Suite 导入成功
- 检查执行成功
- 结果同步正常

**失败条件**:
- GE 连接失败
- Suite 导入失败
- 检查执行失败
- 结果同步异常

---

### INT-003 Kettle 集成

**实现目标**: 集成 Kettle ETL 引擎

**测试步骤**:
1. 配置 Kettle 环境
2. 上传 Kettle 作业文件
3. 执行 Kettle 作业
4. 查看执行日志
5. 监控执行状态
6. 获取执行结果

**成功条件**:
- Kettle 环境配置成功
- 作业文件上传成功
- 作业执行成功
- 日志输出正常

**失败条件**:
- Kettle 环境配置失败
- 作业文件上传失败
- 作业执行失败
- 日志输出异常

---

### INT-004 Hop 集成

**实现目标**: 集成 Apache Hop

**测试步骤**:
1. 配置 Hop 环境
2. 上传 Hop Pipeline 文件
3. 执行 Hop Pipeline
4. 查看执行日志
5. 监控执行状态
6. 获取执行结果

**成功条件**:
- Hop 环境配置成功
- Pipeline 上传成功
- Pipeline 执行成功
- 日志输出正常

**失败条件**:
- Hop 环境配置失败
- Pipeline 上传失败
- Pipeline 执行失败
- 日志输出异常

---

### INT-005 SeaTunnel 集成

**实现目标**: 集成 SeaTunnel CDC

**测试步骤**:
1. 配置 SeaTunnel 环境
2. 创建 SeaTunnel 作业
3. 配置 CDC 源和目标
4. 启动 CDC 同步
5. 监控同步状态
6. 查看同步指标

**成功条件**:
- SeaTunnel 配置成功
- 作业创建成功
- CDC 同步正常
- 指标监控正常

**失败条件**:
- SeaTunnel 配置失败
- 作业创建失败
- CDC 同步异常
- 指标监控异常

---

### INT-006 ShardingSphere 集成

**实现目标**: 集成 ShardingSphere 分库分表

**测试步骤**:
1. 配置 ShardingSphere 连接
2. 配置分片规则
3. 创建分片表
4. 执行分片查询
5. 验证数据分布
6. 监控分片性能

**成功条件**:
- ShardingSphere 配置成功
- 分片规则生效
- 分片查询正常
- 性能监控正常

**失败条件**:
- ShardingSphere 配置失败
- 分片规则不生效
- 分片查询异常
- 性能监控异常

---

## 统计汇总

| 模块 | 功能数 | 功能编号范围 |
|------|--------|-------------|
| 审批工作流 (APR) | 15 | APR-001 ~ APR-015 |
| AI 增强功能 (AI) | 9 | AI-001 ~ AI-009 |
| 认证与授权 (AUTH) | 5 | AUTH-001 ~ AUTH-005 |
| 集成能力 (INT) | 6 | INT-001 ~ INT-006 |
| **总计** | **35** | |

---

## 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| 1.0.0 | 2026-02-09 | 初始版本 |
