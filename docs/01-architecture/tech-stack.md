# 关键技术栈清单

## 技术选型概览

| 分层 | 关键组件/技术 | 推荐版本 | 作用 |
| :--- | :--- | :--- | :--- |
| **网关/安全** | **Istio Gateway** | 1.19+ | 服务网格、mTLS、流量管理 |
| | **Keycloak** | 23.0+ | 统一认证（SSO/OIDC） |
| | **OPA** | 0.60+ | 策略引擎（细粒度鉴权） |
| **应用层 (Agent)** | **React** | 18.x | 前端框架 |
| | **Ant Design** | 5.x | UI 组件库 |
| | **FastAPI** | 0.100+ | 高性能后端框架 |
| | **LangChain** | 0.1+ | LLM 逻辑编排框架 |
| | **LlamaIndex** | 0.9+ | LLM 数据框架 |
| | **Unstructured.io** | 0.11+ | 文档解析引擎 |
| **模型层 (Cube)** | **vLLM** | 0.3+ | LLM 高性能推理 |
| | **TGI** | 1.3+ | 文本生成推理（备选） |
| | **Volcano** | 1.9+ | K8s 批调度器 |
| | **JupyterHub** | 3.0+ | 在线开发环境 |
| | **Ray** | 2.8+ | 分布式计算框架 |
| **数据层 (Data)** | **Spring Boot** | 3.0+ | 后端框架 |
| | **Apache Flink** | 1.17+ | 流式数据处理 |
| | **Apache Spark** | 3.5+ | 批量数据处理 |
| | **SeaTunnel** | 2.3+ | 实时数据集成 |
| | **DataHub** | 0.12+ | 元数据管理 |
| **存储/中间件** | **MinIO** | RELEASE.2023+ | 对象存储（S3 兼容） |
| | **Milvus** | 2.3+ | 向量数据库（推荐） |
| | **PgVector** | 0.5+ | PostgreSQL 向量扩展（备选） |
| | **Apache Doris** | 2.5+ | 实时分析数据库 |
| **基础设施** | **Kubernetes** | 1.27+ | 容器编排 |
| | **Helm** | 3.13+ | 应用包管理 |
| | **Prometheus** | 2.47+ | 监控指标采集 |
| | **Grafana** | 10.x | 监控可视化 |

---

## 按分层详解

### L1 基础设施层

| 组件 | 推荐版本 | 选型理由 |
|------|----------|----------|
| **Kubernetes** | 1.27+ | 容器编排事实标准，1.27+ 稳定支持 Gateway API |
| **containerd** | 1.7+ | 推荐 containerd 替代 Docker，性能更好 |
| **Helm** | 3.13+ | K8s 应用包管理标准，3.13+ 支持 OCI |
| **Istio** | 1.19+ | 服务网格，1.19+ 支持 Ambient 模式（可选） |
| **Prometheus** | 2.47+ | 监控指标采集标准 |
| **Grafana** | 10.x | 监控可视化，与 Prometheus 集成良好 |
| **Loki** | 2.9+ | 日志聚合，与 Grafana 集成 |

### L2 数据底座层 (Data)

| 组件 | 推荐版本 | 选型理由 |
|------|----------|----------|
| **Spring Boot** | 3.0+ | Java 企业级框架，3.0+ 基于 Jakarta EE |
| **Apache Flink** | 1.17+ | 流处理首选，1.17+ 支持 SQL Gateway |
| **Apache Spark** | 3.5+ | 批处理标准，3.5+ 对 AQE 优化更好 |
| **SeaTunnel** | 2.3+ | 新一代数据集成，比 DataX 更现代 |
| **DataHub** | 0.12+ | 元数据管理，比 Atlas 更轻量、API 更友好 |
| **DolphinScheduler** | 3.2+ | 工作流调度，国产开源方案 |
| **MySQL** | 8.0+ | 业务数据库，8.0+ 支持窗口函数、CTE |
| **Redis** | 7.0+ | 缓存，7.0+ 支持 Redis Functions |

### L3 算法引擎层 (Model)

| 组件 | 推荐版本 | 选型理由 |
|------|----------|----------|
| **vLLM** | 0.3+ | LLM 推理首选，PagedAttention 性能优势明显 |
| **TGI** | 1.3+ | 备选方案，HuggingFace 官方支持 |
| **JupyterHub** | 3.0+ | Notebook 多用户环境 |
| **PyTorch** | 2.1+ | 深度学习框架，2.1+ 支持 compile 模式 |
| **Volcano** | 1.9+ | K8s 批调度器，支持 Gang Scheduling |
| **Ray** | 2.8+ | 分布式计算，2.8+ 支持 RLlib 训练 |

### L4 应用编排层 (Agent)

| 组件 | 推荐版本 | 选型理由 |
|------|----------|----------|
| **React** | 18.x | 前端框架，18 支持 Concurrent Features |
| **Ant Design** | 5.x | 企业级 UI 组件库 |
| **FastAPI** | 0.100+ | 高性能 Python API，异步支持 |
| **LangChain** | 0.1+ | LLM 应用框架，生态最成熟 |
| **LlamaIndex** | 0.9+ | LLM 数据框架，RAG 能力强 |
| **Unstructured.io** | 0.11+ | 文档解析，支持多种格式 |

### 存储与中间件

| 组件 | 推荐版本 | 选型理由 |
|------|----------|----------|
| **MinIO** | RELEASE.2023+ | 对象存储，S3 API 兼容，部署简单 |
| **Milvus** | 2.3+ | **推荐** 向量数据库，专为向量设计 |
| **PgVector** | 0.5+ | **备选** PostgreSQL 扩展，适合已有 PG 部署 |
| **Apache Doris** | 2.5+ | 实时分析数据库，MySQL 协议兼容 |
| **ClickHouse** | 23.x | 列式数据库，适合日志分析场景 |
| **Kafka** | 3.6+ | **推荐** 消息队列，高吞吐 |
| **RabbitMQ** | 3.12+ | **备选** 消息队列，简单可靠 |

---

## 关键技术选型决策

### 决策点 1：向量数据库选型

| 方案 | 优势 | 劣势 | 推荐场景 |
|------|------|------|----------|
| **Milvus** | 专为向量设计，性能高，云原生 | 独立部署，运维复杂 | **推荐**，PoC 及生产 |
| **PgVector** | 基于 PostgreSQL，运维简单 | 性能低于专用向量库 | 小规模、已有 PG 部署 |
| **ElasticSearch** | 全文+向量一体 | 向量检索性能一般 | 需要混合检索 |

**决策**：PoC 阶段使用 **Milvus Standalone**，生产环境根据规模选择 Standalone 或 Cluster。

### 决策点 2：消息队列选型

| 方案 | 优势 | 劣势 | 推荐场景 |
|------|------|------|----------|
| **Kafka** | 高吞吐、持久化、生态成熟 | 运维复杂 | **推荐**，大规模数据流 |
| **RabbitMQ** | 简单可靠、协议丰富 | 吞吐较低 | 小规模、业务消息 |

**决策**：推荐 **Kafka**，小规模可先用 RabbitMQ 简化部署。

### 决策点 3：元数据管理选型

| 方案 | 优势 | 劣势 | 推荐场景 |
|------|------|------|----------|
| **DataHub** | 现代、API 友好、UI 好 | 相对较新 | **推荐** |
| **Apache Atlas** | 功能完善、Apache 项目 | 重、复杂 | 大规模企业 |

**决策**：推荐 **DataHub**，更容易集成和维护。

### 决策点 4：服务网格选型

| 方案 | 优势 | 劣势 | 推荐场景 |
|------|------|------|----------|
| **Istio** | 功能完整、CNCF 毕业 | 复杂、资源消耗大 | **推荐**，生产环境 |
| **不启用** | 简单、资源省 | 缺少 mTLS、流量治理 | PoC、小规模 |

**决策**：PoC 阶段**可不启用** Istio，使用简单 Ingress；生产环境推荐启用。

---

## 版本兼容性矩阵

### Python 依赖

| 组件 | Python 版本 | 说明 |
|------|-------------|------|
| LangChain | 3.9+ | 3.10 推荐 |
| vLLM | 3.8+ | 3.10 推荐，CUDA 11.8+ |
| Agent 后端 | 3.9+ | 3.10 推荐 |

### Java 依赖

| 组件 | Java 版本 | 说明 |
|------|-----------|------|
| Spring Boot 3.x | JDK 17+ | 必须使用 JDK 17+ |
| Flink 1.17+ | JDK 11+ | JDK 17 推荐 |

### Kubernetes 版本

| 组件 | 最低 K8s 版本 | 推荐版本 |
|------|--------------|----------|
| Volcano | 1.19+ | 1.25+ |
| Istio | 1.24+ | 1.27+ |
| vLLM (K8s) | 1.21+ | 1.25+ |

---

## 安全与认证

| 组件 | 推荐版本 | 用途 |
|------|----------|------|
| **Keycloak** | 23.0+ | 统一认证（SSO/OIDC） |
| **OAuth2 / OIDC** | - | 认证协议 |
| **LDAP** | - | 企业目录服务集成 |
| **Vault** | 1.15+ | 密钥管理（可选） |
| **OPA** | 0.60+ | 策略引擎 |

---

## 开发工具

| 工具 | 推荐版本 | 用途 |
|------|----------|------|
| Git | 2.40+ | 版本控制 |
| Harbor | 2.9+ | 容器镜像仓库 |
| Jenkins / GitLab CI | - | CI/CD 流水线 |

---

## 更新记录

| 日期 | 版本 | 更新内容 | 更新人 |
|------|------|----------|--------|
| 2024-01-23 | v2.0 | 确认版本号，添加选型理由和决策点 | Claude |
| 2024-01-15 | v1.0 | 初始版本 | Claude |
