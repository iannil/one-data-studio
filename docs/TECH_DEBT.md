# 技术债务清单

> **更新日期**: 2026-02-12
> **目的**: 追踪项目中已知的技术债务，便于后续规划和偿还

---

## 〇、已修复的 BUG

| 位置 | 问题 | 修复日期 |
|------|------|----------|
| `services/agent-api/engine/base_tools.py:380` | 使用未定义变量 `sql_upper` | 2026-01-30 |
| `services/agent-api/engine/nodes.py:97` | 向量检索使用模拟数据 | 2026-02-04 |
| `services/agent-api/app.py:966` | 向量删除不完整 | 2026-02-04 |
| `web/src/pages/chat/ChatPage.tsx:161` | 聊天历史加载缺少错误处理 | 2026-02-04 |

---

## 一、代码中的 TODO 项

### 1.1 高优先级

| 位置 | 内容 | 影响 | 状态 |
|------|------|------|------|
| ~~`services/agent-api/engine/nodes.py:97`~~ | ~~向量检索使用模拟数据~~ | ~~RAG 功能无法正常工作~~ | ✅ 已修复 |
| ~~`web/src/pages/chat/ChatPage.tsx:161`~~ | ~~聊天历史记录硬编码为空数组~~ | ~~用户无法查看历史对话~~ | ✅ 已修复 |

### 1.2 中优先级

| 位置 | 内容 | 影响 |
|------|------|------|
| `services/agent-api/engine/plugin_manager.py:818` | 从类型注解提取参数 | 插件参数配置不够灵活 |
| `web/src/pages/portal/ProfilePage.tsx` | 调用修改密码 API | 修改密码功能未连接后端 |

### 1.3 低优先级

| 位置 | 内容 | 影响 |
|------|------|------|
| `services/ocr-service/services/validator.py:197` | 添加校验码验证 | OCR 识别准确性可提升 |
| `services/data-api/app.py:917` | 从实际表中获取样本数据 | 数据预览功能使用模拟数据 |

### 1.4 待实现功能 (data-api/src/main.py)

| 行号 | 内容 | 模块 |
|------|------|------|
| 1028 | 实现元数据版本历史记录功能 | 元数据管理 |
| 1114 | 实现数据元管理功能 | 数据标准 |
| 1137 | 实现标准库管理功能 | 数据标准 |
| 1157 | 实现标准文档管理功能 | 数据标准 |
| 1177 | 实现标准映射管理功能 | 数据标准 |
| 1232 | 实现完整的资产清单统计功能 | 资产管理 |

---

## 二、待完善功能

### 2.1 P0 - 阻塞性问题

| 功能 | 位置 | 状态 | 说明 |
|------|------|------|------|
| ~~向量检索~~ | ~~`services/agent-api/engine/nodes.py`~~ | ✅ 已改进 | 添加环境变量控制向量服务启用和降级行为 |
| ~~聊天历史~~ | ~~`web/src/pages/chat/ChatPage.tsx`~~ | ✅ 已改进 | 添加错误处理和日志记录 |
| ~~向量删除~~ | ~~`services/agent-api/app.py:966`~~ | ✅ 已修复 | 添加参数验证、SQL 注入防护、批量删除 |

### 2.2 P1 - 重要功能

| 功能 | 位置 | 状态 | 说明 |
|------|------|------|------|
| 工作流编辑器 | `web/src/pages/workflows/WorkflowEditorPage.tsx` | 🟡 基础完成 | 缺少实际编辑逻辑 |
| 模型热切换 | `services/openai-proxy/` | ⚪ 未实现 | 运行时切换模型 |
| 负载均衡优化 | `deploy/` | ⚪ 未实现 | 多实例负载均衡 |

### 2.3 P2 - 增强功能

| 功能 | 位置 | 状态 | 说明 |
|------|------|------|------|
| 数据集版本控制 | `services/data-api/` | ⚪ 未实现 | 数据集自动版本管理 |
| 自动触发训练 | `services/model-api/` | ⚪ 未实现 | 数据更新自动触发训练 |

---

## 三、架构与设计问题

### 3.1 服务依赖

| 问题 | 影响 | 建议 |
|------|------|------|
| Behavior Service 未完全集成 | 行为分析功能未启用 | 已添加到 docker-compose.yml，需要前端集成 |
| 部分服务缺少 API 文档 | 接口使用不清晰 | 补充 OpenAPI/Swagger 文档 |

### 3.2 配置管理

| 问题 | 影响 | 建议 |
|------|------|------|
| 环境变量分散在多个文件 | 配置管理困难 | 统一配置中心（如 Consul） |
| 版本号跳跃 | 版本管理不规范 | 遵循 SemVer 规范 |

---

## 四、代码质量

### 4.1 已清理项目

| 项目 | 状态 | 完成日期 |
|------|------|----------|
| Python 日志规范化 | ✅ 完成 | 2025-01-24 |
| TypeScript 调试代码清理 | ✅ 完成 | 2025-01-24 |
| 重复测试文件合并 | ✅ 完成 | 2026-01-28 |
| Helm Chart 整合 | ✅ 完成 | 2025-01-24 |
| K8s 配置整合 | ✅ 完成 | 2025-01-24 |
| 测试脚本去重 (run_tests.py 删除) | ✅ 完成 | 2026-01-29 |
| 测试报告清理 (playwright-report) | ✅ 完成 | 2026-02-03 |
| Python 缓存清理 (__pycache__) | ✅ 完成 | 2026-02-03 |
| 空目录清理 (tests/) | ✅ 完成 | 2026-02-03 |
| P0 问题修复 (向量检索、聊天历史、向量删除) | ✅ 完成 | 2026-02-04 |
| 认证模块统一整合 | ✅ 完成 | 2026-02-09 |
| console.log 清理 (E2E) | ✅ 完成 | 2026-02-09 |

### 4.2 待改进项

| 项目 | 优先级 | 预计工作量 |
|------|--------|------------|
| ~~认证模块统一整合~~ | ✅ 已完成 | 2026-02-09 |
| ~~console.log 清理 (E2E)~~ | ✅ 已完成 | 2026-02-09 |
| ~~注释代码清理~~ | ✅ 已完成（无需清理） | 2026-02-09 |
| 单元测试覆盖率提升 | P1 | 3 天 |
| API 集成测试完善 | P1 | 2 天 |
| 代码注释补充 | P2 | 2 天 |
| 类型注解完善 (Python) | P2 | 1 天 |

---

## 五、性能优化

| 项目 | 当前状态 | 优化方向 |
|------|----------|----------|
| 向量检索性能 | 未优化 | 添加索引、缓存 |
| API 响应时间 | 部分慢查询 | 数据库查询优化 |
| 前端加载性能 | 待优化 | 代码分割、懒加载 |

---

## 六、安全加固

| 项目 | 状态 | 说明 |
|------|------|------|
| HTTPS 强制 | 🟡 部分 | 生产环境需强制 HTTPS |
| 敏感数据加密 | ✅ 完成 | 密码、Token 已加密 |
| 审计日志 | 🟡 部分 | 部分服务缺少审计 |
| 权限细粒度控制 | 🟡 部分 | RBAC 待完善 |

---

## 七、依赖更新

| 组件 | 当前版本 | 最新版本 | 建议 |
|------|----------|----------|------|
| FastAPI | 0.104.1 | 0.115.0 | 评估后升级 |
| React | 18.2.0 | 18.3.x | 可升级 |
| Ant Design | 5.14.0 | 5.22.x | 可升级 |

---

## 八、偿还计划

### Sprint 33 (已完成 - 2026-02-04)

- [x] 向量检索功能改进 (添加环境变量控制)
- [x] 聊天历史错误处理完善
- [x] 向量删除功能完善

### Sprint 34 (已完成 - 2026-02-04)

- [x] 分阶段测试计划实现
  - [x] 创建测试脚本 (test-phased.sh)
  - [x] 创建环境模板 (.env.example)
  - [x] 创建 6 个阶段的集成测试文件
  - [x] 创建测试指南文档

### Sprint 35 (已完成 - 2026-02-09)

- [x] 文档整理与代码清理
  - [x] 更新记忆系统
  - [x] 整理 progress 目录
  - [x] 更新项目状态文档
- [x] DataOps E2E 全流程测试
- [x] 用户生命周期测试
- [x] OCR 验证实现
- [x] 认证模块统一整合
- [x] console.log 清理
- [x] 注释代码清理（检查后无需清理）

### Sprint 36 (进行中 - 2026-02-12)

- [x] ~~认证模块统一整合~~ (已在 Sprint 35 完成)
- [x] ~~console.log 清理 (E2E)~~ (已在 Sprint 35 完成)
- [x] ~~注释代码清理~~ (已在 Sprint 35 完成，检查后无需清理)
- [x] 文档整理与冗余清理
- [x] BehaviorAnalyzer 类重命名
- [x] TestConfig 共享配置
- [ ] UI E2E 测试完成
- [ ] 全平台 E2E 测试

### 持续改进

- [ ] 依赖定期更新检查
- [ ] 代码审查机制
- [ ] 技术债务定期回顾

---

## 九、债务统计

| 类别 | 数量 | 变化 |
|------|------|------|
| P0 高优先级 | 0 | 认证模块已完成 |
| P1 中优先级 | 3 | -3 (认证/console.log/注释代码已完成) |
| P2 低优先级 | 6 | 无变化 |
| **合计** | **9** | -4 |

> **说明**: Sprint 35 已完成认证模块统一整合、console.log 清理、注释代码检查。

---

> **说明**: 本文档将随着项目进展持续更新。每次 Sprint 后应回顾并更新技术债务清单。
