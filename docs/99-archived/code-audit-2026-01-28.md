# 代码审计报告 2026-01-28

> **审计日期**: 2026-01-28
> **审计范围**: 全仓库代码、文档、部署配置
> **审计目的**: 评估项目实际状态，识别文档与代码的差异

---

## 一、代码规模统计

### 总览

| 指标 | 数量 |
|------|------|
| Python 后端文件 | 274 个 |
| Python 后端代码行 | 142,887 行 |
| TypeScript/TSX 前端文件 | 216 个（194 TSX + 22 TS） |
| TypeScript 前端代码行 | 120,334 行 |
| 测试文件 | 71 个 |
| 测试代码行 | 30,111 行 |
| 部署配置文件 | 155 个 |
| **总计代码行** | **~293,332 行** |

### 后端服务分布

| 服务 | 文件数 | 代码行数 | 占比 |
|------|--------|----------|------|
| Alldata API | 90 | 69,054 | 48.3% |
| Bisheng API | 56 | 23,462 | 16.4% |
| Shared 模块 | 33 | 14,299 | 10.0% |
| OCR Service | 33 | 11,503 | 8.1% |
| Admin API | 25 | 10,316 | 7.2% |
| Cube API | 24 | 10,304 | 7.2% |
| Behavior Service | 11 | 3,058 | 2.1% |
| OpenAI Proxy | 1 | 890 | 0.6% |

---

## 二、服务完成度评估

| 服务 | 代码状态 | 部署状态 | 文档状态 | 综合评级 |
|------|----------|----------|----------|----------|
| Alldata API | ✅ 完整 | ✅ 已部署 | ✅ 已文档化 | 生产就绪 |
| Bisheng API | ✅ 完整 | ✅ 已部署 | ✅ 已文档化 | 生产就绪 |
| OpenAI Proxy | ✅ 完整 | ✅ 已部署 | ✅ 已文档化 | 生产就绪 |
| Shared 模块 | ✅ 完整 | ✅ 已集成 | ✅ 已文档化 | 生产就绪 |
| Admin API | ✅ 完整 | ✅ 已部署 | 🟡 部分文档 | 可用 |
| Cube API | ✅ 完整 | ✅ 已部署 | 🟡 部分文档 | 可用 |
| OCR Service | ✅ 完整 | ✅ 已部署 | 🟡 部分文档 | 可用 |
| Behavior Service | ✅ 完整 | ❌ 未部署 | ❌ 未文档化 | 需关注 |
| Web Frontend | ✅ 完整 | ✅ 已部署 | ✅ 已文档化 | 生产就绪 |

---

## 三、文档与代码差异

### 3.1 代码统计差异（已修复）

旧文档中的统计数据严重过期：

| 类型 | 旧文档数据 | 实际数据 | 差异倍数 |
|------|-----------|----------|----------|
| Python 后端 | 86+ 文件 | 274 文件 | 3.2x |
| TypeScript 前端 | 62+ 文件 | 216 文件 | 3.5x |
| 测试代码 | 24+ 文件 | 71 文件 | 3.0x |
| 部署配置 | 30+ 文件 | 155 文件 | 5.2x |

**原因**: 文档统计停留在 2025-01-24，此后新增了 admin-api、cube-api、ocr-service、behavior-service 等多个服务。

### 3.2 服务发现差异

旧文档仅记录了 4 个后端服务（alldata-api、bisheng-api、openai-proxy、shared），实际已有 8 个服务模块（新增 admin-api、cube-api、ocr-service、behavior-service）。

### 3.3 目录编号冲突（已修复）

`03-progress` 和 `03-testing` 使用了相同的编号前缀，已通过重新编号修复。

---

## 四、发现的问题

### 4.1 未部署服务

**Behavior Service** (`services/behavior-service/`)：
- 代码已完成（11 个 Python 文件，3,058 行代码）
- 未加入 `docker-compose.yml` 部署配置
- 未加入 K8s 部署配置
- 无对应文档

**建议**: 评估是否需要部署此服务。如需要，添加部署配置并编写文档；如不需要，移至 `99-archived/`。

### 4.2 代码中的 TODO 项

共发现 4 个 TODO 项：

| 文件 | TODO 内容 |
|------|-----------|
| `services/ocr-service/services/validator.py` | 添加校验码验证 |
| `services/bisheng-api/engine/plugin_manager.py` | 从类型注解提取参数 |
| `services/alldata-api/app.py` | 从实际表中获取样本数据 |
| `web/src/pages/portal/ProfilePage.tsx` | 调用修改密码 API |

### 4.3 版本号策略

CHANGELOG.md 中版本号存在跳跃：`0.1.0 → 0.2.0 → 0.3.0 → 0.4.0 → 0.9.1 → 0.9.2 → 1.0.0-rc → 1.2.0`

建议后续版本发布时遵循 SemVer 规范，明确版本递增策略。

---

## 五、建议行动项

### 高优先级

1. **决定 Behavior Service 状态**: 部署上线或归档
2. **为新增服务补充文档**: admin-api、cube-api、ocr-service 需要 API 端点文档

### 中优先级

3. **处理 TODO 项**: 特别是修改密码 API 和插件参数提取
4. **统一版本策略**: 确定后续版本号规范

### 低优先级

5. **定期代码审计**: 建议每月更新代码统计，保持文档准确性
6. **CLAUDE.md 更新**: 项目根目录的 CLAUDE.md 中的代码统计也需要与实际保持一致

---

## 审计结论

项目代码规模已从最初记录的约 200 个文件增长到 700+ 个文件，代码总量超过 29 万行。8 个后端服务中有 7 个已部署可用，1 个待决策。文档体系总体完整，本次审计主要修复了数据过期和目录冲突问题。项目整体处于 Alpha 阶段，核心功能已实现，具备 PoC 演示能力。
