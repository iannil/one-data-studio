# ONE-DATA-STUDIO Environment Configuration
# Sprint 21: Security Hardening
#
# Copy this file to .env and update values for your environment.
# NEVER commit .env files containing real credentials to version control.

# =============================================================================
# Environment
# =============================================================================
ENVIRONMENT=development
FLASK_ENV=development
DEBUG=true
LOG_LEVEL=INFO

# =============================================================================
# Database (MySQL)
# =============================================================================
MYSQL_HOST=mysql.one-data-infra.svc.cluster.local
MYSQL_PORT=3306
MYSQL_USER=one_data
MYSQL_PASSWORD=<CHANGE_ME>
MYSQL_DATABASE=one_data_studio

# MySQL HA Configuration
MYSQL_HA_ENABLED=false
MYSQL_PRIMARY_HOST=mysql-primary.one-data-infra.svc.cluster.local
MYSQL_REPLICA_HOST=mysql-replica.one-data-infra.svc.cluster.local

# Connection Pool
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# =============================================================================
# Redis
# =============================================================================
REDIS_ENABLED=true
REDIS_HOST=redis.one-data-infra.svc.cluster.local
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=<CHANGE_ME>
REDIS_MAX_CONNECTIONS=50

# Redis Sentinel HA
REDIS_SENTINEL_ENABLED=false
REDIS_SENTINEL_MASTER=mymaster
REDIS_SENTINEL_HOSTS=redis-sentinel:26379
REDIS_SENTINEL_PASSWORD=

# Cache TTL (seconds)
CACHE_METADATA_TTL=300
CACHE_MODEL_LIST_TTL=600
CACHE_WORKFLOW_TTL=180
CACHE_SEARCH_RESULT_TTL=60

# =============================================================================
# MinIO Object Storage
# =============================================================================
MINIO_ENDPOINT=minio.one-data-infra.svc.cluster.local:9000
MINIO_ACCESS_KEY=<CHANGE_ME>
MINIO_SECRET_KEY=<CHANGE_ME>
MINIO_DEFAULT_BUCKET=one-data-studio
MINIO_USE_SSL=false

# =============================================================================
# Milvus Vector Database
# =============================================================================
MILVUS_HOST=milvus.one-data-infra.svc.cluster.local
MILVUS_PORT=19530
EMBEDDING_DIM=1536
MILVUS_INDEX_TYPE=IVF_FLAT
MILVUS_METRIC_TYPE=L2
MILVUS_NLIST=128

# =============================================================================
# OpenAI / LLM Configuration
# =============================================================================
OPENAI_API_KEY=<CHANGE_ME>
# Multiple keys (comma-separated for load balancing)
OPENAI_API_KEYS=
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini
OPENAI_TEMPERATURE=0.7
OPENAI_MAX_TOKENS=2000
OPENAI_TIMEOUT=30
OPENAI_KEY_ROTATION_STRATEGY=round_robin

# =============================================================================
# vLLM Self-hosted LLM Service
# =============================================================================
# vLLM Chat Service (for LLM inference, Text-to-SQL, etc.)
VLLM_CHAT_URL=http://vllm-chat:8000
VLLM_CHAT_MODEL=Qwen/Qwen2.5-1.5B-Instruct
# vLLM Embedding Service (for text vectorization)
VLLM_EMBED_URL=http://vllm-embed:8000
VLLM_EMBED_MODEL=BAAI/bge-base-zh-v1.5
# GPU memory utilization (0.0-1.0)
VLLM_GPU_MEMORY_UTILIZATION=0.8
# HuggingFace token for gated models (optional)
HF_TOKEN=
# Enable/disable AI features globally
AI_FEATURES_ENABLED=true

# =============================================================================
# Keycloak Authentication
# =============================================================================
KEYCLOAK_URL=http://keycloak.one-data-system.svc.cluster.local:80
KEYCLOAK_REALM=one-data-studio
KEYCLOAK_CLIENT_ID=web-frontend
KEYCLOAK_CLIENT_SECRET=<CHANGE_ME>

# =============================================================================
# JWT Configuration
# =============================================================================
JWT_SECRET_KEY=<CHANGE_ME_TO_RANDOM_STRING>
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE=3600
JWT_REFRESH_TOKEN_EXPIRE=604800
JWT_KEY_ROTATION_PERIOD=86400
JWT_KEY_GRACE_PERIOD=7200

# =============================================================================
# Security Configuration (Sprint 21)
# =============================================================================
# CSRF Protection
CSRF_SECRET_KEY=<CHANGE_ME_TO_RANDOM_STRING>
CSRF_TOKEN_EXPIRY=3600
CSRF_HEADER_NAME=X-CSRF-Token
CSRF_COOKIE_NAME=csrf_token

# CORS Configuration
CORS_ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
CORS_ALLOW_ALL=false

# Security Headers
SECURITY_HSTS_ENABLED=true
SECURITY_HSTS_MAX_AGE=31536000
SECURITY_CSP_ENABLED=true
SECURITY_FRAME_OPTIONS=DENY
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin

# HTTPS Enforcement
SECURITY_FORCE_HTTPS=true
SECURITY_TRUST_PROXY=true

# Cookie Security
AUTH_COOKIE_ACCESS=access_token
AUTH_COOKIE_REFRESH=refresh_token
AUTH_COOKIE_DOMAIN=
AUTH_COOKIE_SAMESITE=Lax

# =============================================================================
# Service URLs
# =============================================================================
DATA_API_URL=http://data-api:8001
AGENT_API_URL=http://agent-api:8000
MODEL_API_URL=http://model-api:8002
OPENAI_PROXY_URL=http://openai-proxy:8000

# =============================================================================
# Celery Task Queue
# =============================================================================
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3000
CELERY_WORKER_MAX_TASKS=100
CELERY_RESULT_EXPIRES=86400

# =============================================================================
# Logging
# =============================================================================
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_FILE=

# =============================================================================
# Feature Flags
# =============================================================================
FEATURE_MULTIMODAL_ENABLED=true
FEATURE_AGENT_TOOLS_ENABLED=true
FEATURE_I18N_ENABLED=true

# =============================================================================
# OpenMetadata Integration
# =============================================================================
OPENMETADATA_HOST=openmetadata.one-data-infra.svc.cluster.local
OPENMETADATA_PORT=8585
OPENMETADATA_ENABLED=true
OPENMETADATA_API_VERSION=v1
OPENMETADATA_TIMEOUT=30
# Optional: JWT token for OpenMetadata authentication (leave empty for no-auth mode)
OPENMETADATA_JWT_TOKEN=

# =============================================================================
# Kettle/PDI ETL Engine
# =============================================================================
# Kettle Carte server URL for remote transformation execution
KETTLE_CARTE_URL=http://kettle:8181
# SECURITY: Carte credentials MUST be changed in production
KETTLE_CARTE_USER=cluster
KETTLE_CARTE_PASSWORD=<CHANGE_ME>
# Enable/disable Kettle integration
KETTLE_ENABLED=true
