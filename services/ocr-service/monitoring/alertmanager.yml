# AlertManageré…ç½®

global:
  # å…¨å±€resolveè¶…æ—¶
  resolve_timeout: 5m
  # SMTPé…ç½®
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alerts@example.com'
  smtp_auth_username: 'alerts@example.com'
  smtp_auth_password: 'password'
  smtp_require_tls: true

# è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶å™¨
  receiver: 'default'
  # åˆ†ç»„ç­‰å¾…æ—¶é—´
  group_wait: 10s
  # åˆ†ç»„é—´éš”æ—¶é—´
  group_interval: 10s
  # é‡å¤é€šçŸ¥é—´éš”
  repeat_interval: 12h
  # è·¯ç”±æ ‘
  routes:
    # criticalçº§åˆ«å‘Šè­¦
    - match:
        severity: critical
      receiver: 'critical'
      group_wait: 10s
      repeat_interval: 5m

    # warningçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning'
      group_wait: 30s
      repeat_interval: 1h

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/webhook'
        send_resolved: true

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical'
    email_configs:
      - to: 'oncall@example.com'
        headers:
          Subject: 'ğŸš¨ [CRITICAL] OCRæœåŠ¡å‘Šè­¦'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/critical'
        send_resolved: true
    # é’‰é’‰é€šçŸ¥ (éœ€è¦é…ç½®é’‰é’‰æœºå™¨äºº)
    # wechat_configs:
    #   - corp_id: 'your-corp-id'
    #     agent_id: 'your-agent-id'
    #     api_secret: 'your-api-secret'
    #     to_user: '@all'

  # è­¦å‘Šå‘Šè­¦æ¥æ”¶å™¨
  - name: 'warning'
    email_configs:
      - to: 'team@example.com'
        headers:
          Subject: 'âš ï¸ [WARNING] OCRæœåŠ¡è­¦å‘Š'
    webhook_configs:
      - url: 'http://localhost:5001/webhook/warning'
        send_resolved: true

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å½“æœåŠ¡ä¸å¯ç”¨æ—¶ï¼ŒæŠ‘åˆ¶å…¶ä»–å‘Šè­¦
  - source_match:
      severity: 'critical'
      alertname: 'OCRServiceDown'
    target_match_re:
      severity: '(warning|info)'
    equal: ['job']

  # å½“ä»»åŠ¡å¤±è´¥ç‡è¿‡é«˜æ—¶ï¼ŒæŠ‘åˆ¶å¤„ç†æ—¶é—´å‘Šè­¦
  - source_match:
      alertname: 'HighTaskFailureRate'
    target_match:
      alertname: 'HighProcessingTime'
    equal: ['job']

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'
