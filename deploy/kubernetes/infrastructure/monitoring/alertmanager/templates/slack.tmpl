{{ define "slack.title" -}}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}
{{- end }}

{{ define "slack.text" -}}
{{ range .Alerts }}
*Alert:* {{ .Annotations.summary }}
*Severity:* `{{ .Labels.severity }}`
*Description:* {{ .Annotations.description }}
*Details:*
{{ range .Labels.SortedPairs }}  â€¢ *{{ .Name }}:* `{{ .Value }}`
{{ end }}
{{ if .Annotations.runbook_url }}*Runbook:* {{ .Annotations.runbook_url }}{{ end }}
---
{{ end }}
{{- end }}

{{ define "slack.color" -}}
{{ if eq .Status "firing" -}}
  {{ if eq .CommonLabels.severity "critical" -}}
    danger
  {{- else if eq .CommonLabels.severity "warning" -}}
    warning
  {{- else -}}
    #439FE0
  {{- end -}}
{{- else -}}
  good
{{- end }}
{{- end }}

{{ define "pagerduty.description" -}}
{{ .CommonAnnotations.summary }}
{{- end }}

{{ define "pagerduty.firing" -}}
{{ range .Alerts.Firing }}
Alert: {{ .Labels.alertname }}
Severity: {{ .Labels.severity }}
Summary: {{ .Annotations.summary }}
Description: {{ .Annotations.description }}
{{ end }}
{{- end }}

{{ define "email.subject" -}}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}
{{- end }}

{{ define "email.html" -}}
<!DOCTYPE html>
<html>
<head>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.alert { padding: 15px; margin-bottom: 10px; border-radius: 4px; }
.critical { background-color: #f8d7da; border: 1px solid #f5c6cb; }
.warning { background-color: #fff3cd; border: 1px solid #ffeeba; }
.resolved { background-color: #d4edda; border: 1px solid #c3e6cb; }
h2 { color: #333; }
.label { font-weight: bold; }
</style>
</head>
<body>
<h1>ONE-DATA-STUDIO Alert Notification</h1>
<p>Status: <strong>{{ .Status | toUpper }}</strong></p>

{{ if gt (len .Alerts.Firing) 0 }}
<h2>Firing Alerts</h2>
{{ range .Alerts.Firing }}
<div class="alert {{ .Labels.severity }}">
<h3>{{ .Labels.alertname }}</h3>
<p><span class="label">Severity:</span> {{ .Labels.severity }}</p>
<p><span class="label">Summary:</span> {{ .Annotations.summary }}</p>
<p><span class="label">Description:</span> {{ .Annotations.description }}</p>
<p><span class="label">Labels:</span></p>
<ul>
{{ range .Labels.SortedPairs }}
<li><strong>{{ .Name }}:</strong> {{ .Value }}</li>
{{ end }}
</ul>
{{ if .Annotations.runbook_url }}
<p><a href="{{ .Annotations.runbook_url }}">View Runbook</a></p>
{{ end }}
</div>
{{ end }}
{{ end }}

{{ if gt (len .Alerts.Resolved) 0 }}
<h2>Resolved Alerts</h2>
{{ range .Alerts.Resolved }}
<div class="alert resolved">
<h3>{{ .Labels.alertname }}</h3>
<p>{{ .Annotations.summary }}</p>
</div>
{{ end }}
{{ end }}

<p><a href="https://grafana.example.com/d/one-data-overview">View Dashboard</a></p>
</body>
</html>
{{- end }}
